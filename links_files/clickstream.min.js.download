window._csq = window._csq || []; window._csq._experimentsFromServer = {};(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports=function(window,Storage,session,Guid,_,CSArray,CSExperimentsEngine,CSEventTracker){"use strict";var _csq=window._csq=window._csq||[],store=Storage(window),guid=Guid(),csa=CSArray(),tracker=CSEventTracker(_csq.platform,_csq.host,_csq.userIdKey,window,store,session,guid,_,_csq.debug),cse=CSExperimentsEngine(_csq._experimentsFromServer,_csq.timeout,store,tracker,window);if(_csq.timeout){tracker.trackEvent({name:"cs_timeout",data:{threshold:_csq.timeoutThreshold}})}csa.onPush("event",function(event){tracker.trackEvent(event);cse.activateExperimentsForEvent(event.name)});csa.onPush("setView",function(view){tracker.setView(view)});csa.onPush("experimentObserver",function(expName,observer){cse.observeExperiment(expName,observer)});csa.load(_csq);window._csq.loaded=true}},{}],2:[function(require,module,exports){function CSArray(){this._data=[];this._handlers={};this.views=[];this.experimentObservers=[];this.events=[]}CSArray.prototype.load=function(arr){var self=this;for(var i=0;i<arr.length;i++){self.push(arr[i],arr[i+1],arr[i+2])}arr.push=function(){var argArray=Array.prototype.slice.call(arguments);self.push.apply(self,argArray);for(var i=0;i<argArray.length;i++){arr[arr.length]=argArray[i]}}};CSArray.prototype.onPush=function(name,handler){if(typeof name!=="string"||typeof handler!=="function"){return console.log("invalid options given to CSArray.onPush:",name,handler)}this._handlers[name]=this._handlers[name]||[];this._handlers[name].push(handler)};CSArray.prototype._firePushHanders=function(name,arg1,arg2){var self=this;if(self._handlers[name]){setTimeout(function(){for(var i=0;i<self._handlers[name].length;i++){self._handlers[name][i](arg1,arg2)}},0)}};CSArray.prototype._isEvent=function _isEvent(){return typeof arguments[0]==="object"};CSArray.prototype._isSetView=function _isSetView(method,view){if(method==="setView"&&typeof view==="string"){return view}};CSArray.prototype._isExperimentObserver=function _isExperimentObserver(expObs,expName,observer){if(expObs==="experimentObserver"&&typeof expName==="string"&&typeof observer==="function"){return{experimentName:expName,observer:observer}}};CSArray.prototype.push=function(){var tempView=this._isSetView(arguments[0],arguments[1]);if(tempView){this.views.push(tempView);if(arguments.length===3){this._firePushHanders("setView",tempView,arguments[2]||{})}else{this._firePushHanders("setView",tempView,{})}return true}var tempObserver=this._isExperimentObserver(arguments[0],arguments[1],arguments[2]);if(tempObserver){this.experimentObservers.push(tempObserver);this._firePushHanders("experimentObserver",tempObserver.experimentName,tempObserver.observer);return true}if(this._isEvent(arguments[0])){this.events.push(arguments[0]);this._firePushHanders("event",arguments[0]);return true}return false};module.exports=function(){return new CSArray}},{}],3:[function(require,module,exports){module.exports=function(platform,host,userIdKey,window,storage,session,guid,_,debug){return new CSEventTracker(platform,host,userIdKey,window,storage,session,guid,_,debug)};function CSEventTracker(platform,host,userIdKey,window,storage,session,guid,_,debug){this._platform=platform;this._url=(host||"https://clickstream.grubhub.com")+"/event.gif?event=";this._userIdKey=userIdKey;this._window=window;this._storage=storage;this._session=session;this._guid=guid;this._currentView=null;this._sequence=0;this._=_;this._debug=debug?true:false;if(this._debug){this._window._csqLog=window._csqLog=[]}this._getSessionData()}CSEventTracker.prototype.trackEvent=function trackEvent(eventObj){var o=eventObj||{},now=new Date,sessionData=this._getSessionData(),trackingObj={name:o.name||null,platform:o.platform||this._platform||"",browserId:o.browserId||this._storage.localVar("clickstreamBrowserId")||this._storage.localVar("clickstreamBrowserId",this._guid.create()),sessionId:o.sessionId||sessionData.sessionId,sessionStartDateTime:sessionData.sessionStartDateTime,userId:""+(o.userId||this._storage.localVar(this._userIdKey)||this._storage.sessionVar(this._userIdKey)||""),referrer:o.referrer||this._window.document.referrer||"",userAgent:o.userAgent||this._window.navigator.userAgent,protocol:o.protocol||this._window.location.protocol,hostname:o.hostname||this._window.location.hostname,pathname:o.pathname||this._window.location.pathname,queryParams:o.search||this._window.location.search,view:o.view||this._currentView,data:o.data||{},sequence:++this._sequence,dateTime:now,timezone:now.getTimezoneOffset()};for(var i in trackingObj.data){if(this._.isFunction(trackingObj.data[i])){trackingObj.data[i]=trackingObj.data[i]()}}var event=this._window.document.createElement("img");event.src=this._url+escape(JSON.stringify(trackingObj));if(this._debug){this._window._csqLog.push(trackingObj)}};CSEventTracker.prototype.setView=function setView(view){var prevView=this._currentView;this._currentView=view;this.trackEvent({name:"cs_view_change",data:{previous_view:prevView}})};CSEventTracker.prototype._getSessionData=function _getSessionData(){var self=this;return this._session("clickstream",this._storage,this._guid.create,function(){self.trackEvent({name:"sessionStarted"})})}},{}],4:[function(require,module,exports){"use strict";module.exports=function(experimentsFromServer,timedOut,storage,tracker,window){return new CSExperimentsEngine(experimentsFromServer,timedOut,storage,tracker,window)};function CSExperimentsEngine(expFromServer,timedOut,storage,tracker,window){this._timedOut=timedOut?true:false;this._storage=storage;this._tracker=tracker;this._experimentObservers=[];this._eventExperimentActivationHash={};this._firedEventsHash={};this._experiments=this._storage.localVar("clicktimizelyExperiments")||{};this._window=window;var experimentsFromServer=expFromServer||{},key;for(key in this._experiments){if(experimentsFromServer[key]===undefined||experimentsFromServer[key].active===false){delete this._experiments[key]}}for(key in experimentsFromServer){if(experimentsFromServer[key].active===true){var tempExp=this._experiments[key];if(tempExp&&!this._isExperimentActivated(tempExp)&&this._experiments[key].requiredEvents.length){this._activateExperimentOnEvents(this._experiments[key])}else if(!tempExp||!this._isExperimentActivated(tempExp)||experimentsFromServer[key].activations[0].id!==this._experiments[key].activations[0].id){this._experiments[key]=experimentsFromServer[key];if(this._experiments[key].requiredEvents.length){this._activateExperimentOnEvents(this._experiments[key])}else{this._activateExperiment(this._experiments[key])}}}}this._saveExperiments()}CSExperimentsEngine.prototype.observeExperiment=function addObserver(expName,observer){if(!expName||typeof expName!=="string"||!observer||typeof observer!=="function"){return console.log("observeExperiment called with bad arguments, requires name (string), observer (function):",arguments)}var self=this,exp=self._findExperiment(expName);if(self._isExperimentActivated(exp)){setTimeout(function(){observer(self._getExperimentTreatment(exp))},0);return}this._experimentObservers.push({experimentName:expName,observer:observer})};CSExperimentsEngine.prototype.activateExperimentsForEvent=function addObserver(eventName){if(!eventName||typeof eventName!=="string"){return console.log("activateExperimentsForEvent called with bad arguments, requires eventName (string):",eventName)}this._firedEventsHash[eventName]=true;if(this._eventExperimentActivationHash[eventName]){for(var i=0;i<this._eventExperimentActivationHash[eventName].length;i++){this._activateExperiment(this._eventExperimentActivationHash[eventName][i])}}};CSExperimentsEngine.prototype._findExperiment=function _findExperiment(expName){for(var key in this._experiments){if(expName===this._experiments[key].name){return this._experiments[key]}}};CSExperimentsEngine.prototype._getExperimentTreatment=function _getExperimentTreatment(exp){if(exp&&exp.treatment){return exp.treatment}return"control"};CSExperimentsEngine.prototype._isExperimentActivated=function _isExperimentActivated(exp){if(exp){return exp.activated}return true};CSExperimentsEngine.prototype._runExperimentObservers=function _runExperimentObservers(expName){var self=this,exp=self._findExperiment(expName);setTimeout(function(){if(self._experimentObservers.length){for(var i=0;i<self._experimentObservers.length;i++){if(self._experimentObservers[i].experimentName===expName&&!self._experimentObservers[i].hasRun&&self._isExperimentActivated(exp)){self._experimentObservers[i].hasRun=true;self._experimentObservers[i].observer(self._getExperimentTreatment(exp))}}}},0)};CSExperimentsEngine.prototype._saveExperiments=function _saveExperiments(){this._storage.localVar("clicktimizelyExperiments",this._experiments)};CSExperimentsEngine.prototype._activateExperiment=function _activateExperiment(experiment){if(!experiment||experiment.activated||this._timedOut){return}experiment.activated=true;this._experiments[experiment.id]=experiment;var expData={experiment_name:experiment.name,treatment:experiment.treatment,experiment_id:experiment.id,required_event_id:null,required_event:null,activation_start_date_time:null,activation_id:null};if(experiment.activations.length){expData.activation_id=experiment.activations[0].id;expData.activation_start_date_time=experiment.activations[0].startDtTm}if(experiment.requiredEvents.length){expData.required_event_id=experiment.requiredEvents[0].id;expData.required_event=experiment.requiredEvents[0].name}this._tracker.trackEvent({name:"optimizely_experiment_applied",data:expData});this._runExperimentObservers(experiment.name);this._saveExperiments()};CSExperimentsEngine.prototype._activateExperimentOnEvents=function _activateExperimentOnEvents(exp){for(var i=0;i<exp.requiredEvents.length;i++){this._eventExperimentActivationHash[exp.requiredEvents[i].name]=this._eventExperimentActivationHash[exp.requiredEvents[i].name]||[];this._eventExperimentActivationHash[exp.requiredEvents[i].name].push(exp)}};try{delete window.localStorage["clickstreamActiveExperiments"]}catch(e){}},{}],5:[function(require,module,exports){module.exports=function(){"use strict";function shortId(){var values="";for(var i=0;i<25;i++){values+=(Math.random()*36<<0).toString(36)}return values}function create(){return shortId()+(new Date).valueOf()}return{shortId:shortId,create:create}}},{}],6:[function(require,module,exports){require("./clickstream")(window,require("./storage"),require("./session"),require("./guid"),require("./util"),require("./csArray"),require("./csExperimentsEngine"),require("./csEventTracker"))},{"./clickstream":1,"./csArray":2,"./csEventTracker":3,"./csExperimentsEngine":4,"./guid":5,"./session":7,"./storage":8,"./util":9}],7:[function(require,module,exports){module.exports=function(prefix,storage,idGenerator,startCallback){var sessionStart=false,sessionId=storage.localVar(prefix+"SessionId"),sessionStartDateTimeFromStorage=storage.localVar(prefix+"SessionStartDateTime"),sessionStartDateTime=sessionStartDateTimeFromStorage?new Date(sessionStartDateTimeFromStorage):new Date,sessionDTStamp=new Date(storage.localVar(prefix+"SessionDateTimeStamp")),sessionSeq=storage.localVar(prefix+"SessionSequence")||0,thirtyMinsAgo=new Date;thirtyMinsAgo.setTime(thirtyMinsAgo.getTime()-30*6e4);if(!sessionStartDateTimeFromStorage||!sessionId||!sessionDTStamp||sessionId&&sessionDTStamp<thirtyMinsAgo){sessionId=storage.localVar(prefix+"SessionId",idGenerator());storage.localVar(prefix+"SessionStartDateTime",sessionStartDateTime.valueOf());storage.localVar(prefix+"SessionSequence",++sessionSeq);sessionStart=true}storage.localVar(prefix+"SessionDateTimeStamp",(new Date).valueOf());if(sessionStart){startCallback()}return{sessionId:sessionId,sessionSeq:sessionSeq,sessionDTStamp:sessionDTStamp,sessionStartDateTime:sessionStartDateTime}}},{}],8:[function(require,module,exports){module.exports=function(window){"use strict";function readCookie(cookieName){var re=new RegExp("[; ]"+cookieName+"=([^;]*)"),sMatch=(" "+window.document.cookie).match(re);if(cookieName&&sMatch){return sMatch[1]}return null}function writeCookie(cookieMap){for(var key in cookieMap){if(cookieMap.hasOwnProperty(key)){window.document.cookie=""+key+"="+cookieMap[key]}}}var localStorageEnabled=false,sessionStorage={};try{window.localStorage["cs.enabled"]=true;localStorageEnabled=true;delete window.localStorage["cs.enabled"]}catch(e){}try{window.sessionStorage["cs.enabled"]=true;delete window.sessionStorage["cs.enabled"];sessionStorage=window.sessionStorage}catch(e){}function store(opts){var o=opts||{},name=o.name,value=o.value,session=o.session;if(!!name){if(!!value){if(session===true){sessionStorage[name]=JSON.stringify(value)}else{if(localStorageEnabled){window.localStorage[name]=JSON.stringify(value)}else{var cookie={};cookie[name]=JSON.stringify(value);writeCookie(cookie)}}return value}else{if(session===true){try{return JSON.parse(sessionStorage[name])||null}catch(e){return sessionStorage[name]||null}}else if(localStorageEnabled){try{return JSON.parse(window.localStorage[name]||null)}catch(e){return window.localStorage[name]||null}}else{return JSON.parse(readCookie(name))}}}}return{localVar:function localVarStore(name,value){return store({name:name,value:value,session:false})},sessionVar:function sessionVarStore(name,value){return store({name:name,value:value,session:true})}}}},{}],9:[function(require,module,exports){"use strict";var types="Boolean Number String Function Array Date RegExp Object Error".split(" "),class2type={},toString=class2type.toString,_;for(var i in types){if(types.hasOwnProperty(i)){class2type["[object "+types[i]+"]"]=types[i].toLowerCase()}}module.exports=_={type:function(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj},isFunction:function(obj){return _.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isPlainObject:function(obj){if(_.type(obj)!=="object"||obj.nodeType||_.isWindow(obj)){return false}try{if(obj.constructor&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}return true},extend:function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++}if(typeof target!=="object"&&!_.isFunction(target)){target={}}if(i===length){target={};i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(_.isPlainObject(copy)||(copyIsArray=_.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&_.isArray(src)?src:[]}else{clone=src&&_.isPlainObject(src)?src:{}}target[name]=_.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target}}},{}]},{},[6]);